# üîç –ê—É–¥–∏—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –≤—Å–µ–≥–æ —Å–∞–π—Ç–∞

## üìä –ù–∞–π–¥–µ–Ω–Ω—ã–µ —É–∑–∫–∏–µ –º–µ—Å—Ç–∞ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### ‚úÖ **–£–∂–µ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ**

1. **–°–æ–∑–¥–∞–Ω–∏–µ –∑–∞—è–≤–æ–∫** (`/create-request`) - 70-80% —É—Å–∫–æ—Ä–µ–Ω–∏—è
2. **–°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–π** (`/companies`) - –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π –ø–µ—Ä–µ–≤–æ–¥

---

## üö® **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —É–∑–∫–∏–µ –º–µ—Å—Ç–∞**

### 1. **–ë–ª–æ–≥ —Å—Ç–∞—Ç—å–∏ - —Å–æ–∑–¥–∞–Ω–∏–µ –∏ –ø–µ—Ä–µ–≤–æ–¥**

**–§–∞–π–ª**: `routers/blog.py:58-172`

**–ü—Ä–æ–±–ª–µ–º–∞**: –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–π –ø–µ—Ä–µ–≤–æ–¥ –≤—Å–µ—Ö –ø–æ–ª–µ–π (title, content, description, keywords) √ó 5 —è–∑—ã–∫–æ–≤ = ~20+ API –≤—ã–∑–æ–≤–æ–≤

**–†–µ—à–µ–Ω–∏–µ**:

```python
# –î–æ: –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ –ø–µ—Ä–µ–≤–æ–¥—ã –≤ —Ü–∏–∫–ª–µ
for field_name, field_translations in translations.items():
    for target_lang in SUPPORTED_LANGUAGES:
        if not field_translations[target_lang].strip():
            translated = await translate_text(...)  # –º–µ–¥–ª–µ–Ω–Ω–æ

# –ü–æ—Å–ª–µ: –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –ø–µ—Ä–µ–≤–æ–¥—ã
texts_to_translate = []
for field_name, field_translations in translations.items():
    for target_lang in SUPPORTED_LANGUAGES:
        if not field_translations[target_lang].strip():
            texts_to_translate.append({...})

# –í—Å–µ –ø–µ—Ä–µ–≤–æ–¥—ã –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
translation_results = await translate_text_batch_with_semaphore(texts_to_translate)
```

**–£—Å–∫–æ—Ä–µ–Ω–∏–µ**: 80-90% (—Å 10-15 —Å–µ–∫ –¥–æ 2-3 —Å–µ–∫)

### 2. **–°–ø–∏—Å–æ–∫ –∑–∞—è–≤–æ–∫ —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏**

**–§–∞–π–ª**: `services/bids/service.py:239-295`

**–ü—Ä–æ–±–ª–µ–º—ã**:

- –ü–æ–∏—Å–∫ –ø–æ 10 —Ç–µ–∫—Å—Ç–æ–≤—ã–º –ø–æ–ª—è–º –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è JSON –º–∞—Å—Å–∏–≤–æ–≤ –±–µ–∑ –∏–Ω–¥–µ–∫—Å–æ–≤
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

**–†–µ—à–µ–Ω–∏–µ**:

```python
# –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å —Å –∏–Ω–¥–µ–∫—Å–∞–º–∏
async def list_bids_optimized(self, filters):
    # –ö—ç—à–∏—Ä—É–µ–º –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
    cache_key = f"bids:{hash(str(filters))}"
    cached = await get_from_cache(cache_key)
    if cached:
        return cached

    # –ò—Å–ø–æ–ª—å–∑—É–µ–º select_related –¥–ª—è —É–º–µ–Ω—å—à–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤
    qs = Bid.all().select_related('country', 'author')

    # –î–æ–±–∞–≤–ª—è–µ–º —Ñ–∏–ª—å—Ç—Ä—ã –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
    if filters.get('country'):
        qs = qs.filter(country_id=filters['country'])

    # –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫ –≤–º–µ—Å—Ç–æ ILIKE
    if filters.get('search'):
        qs = qs.filter(search_vector=filters['search'])

    result = await qs.limit(filters.get('limit', 20))
    await cache_result(cache_key, result, ttl=300)  # 5 –º–∏–Ω—É—Ç
    return result
```

### 3. **–°–ø–∏—Å–æ–∫ –∫–æ–º–ø–∞–Ω–∏–π —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏**

**–§–∞–π–ª**: `crud/company.py:9-49`

**–ü—Ä–æ–±–ª–µ–º—ã**:

- –ü–æ–∏—Å–∫ –ø–æ 5 description –ø–æ–ª—è–º —Å ILIKE
- ManyToMany –∑–∞–ø—Ä–æ—Å—ã –±–µ–∑ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏ –∫—ç—à–∞

**–†–µ—à–µ–Ω–∏–µ**: –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ –∑–∞—è–≤–∫–∞–º + –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è ManyToMany

---

## ‚ö° **–°—Ä–µ–¥–Ω–∏–µ —É–∑–∫–∏–µ –º–µ—Å—Ç–∞**

### 4. **–ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å - –ø–æ–ª—É—á–µ–Ω–∏–µ –∑–∞—è–≤–æ–∫**

**–§–∞–π–ª**: `api/admin.py:340-377`

**–ü—Ä–æ–±–ª–µ–º–∞**: N+1 –∑–∞–ø—Ä–æ—Å –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

```python
# –ü–ª–æ—Ö–æ: N+1 –∑–∞–ø—Ä–æ—Å
bids = await Bid.all().offset(offset).limit(limit).prefetch_related("user").all()
for bid in bids:
    bid.user.email  # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å –¥–ª—è –∫–∞–∂–¥–æ–π –∑–∞—è–≤–∫–∏
```

**–†–µ—à–µ–Ω–∏–µ**:

```python
# –•–æ—Ä–æ—à–æ: –æ–¥–∏–Ω –∑–∞–ø—Ä–æ—Å
bids = await Bid.all().select_related("author").offset(offset).limit(limit)
```

### 5. **–ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–µ–π –±–ª–æ–≥–∞**

**–§–∞–π–ª**: `api/blog.py:7-38`

**–ü—Ä–æ–±–ª–µ–º–∞**: –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö —Å—Ç–∞—Ç–µ–π –±–µ–∑ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è

**–†–µ—à–µ–Ω–∏–µ**:

```python
# –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Å—Ç–∞—Ç–µ–π
@cache(ttl=600)  # 10 –º–∏–Ω—É—Ç
async def get_blog_articles_cached(lang, limit, offset):
    return await BlogArticle.filter(is_published=True)...
```

---

## üõ†Ô∏è **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö**

### –ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∏–Ω–¥–µ–∫—Å—ã:

```sql
-- –î–ª—è –∑–∞—è–≤–æ–∫
CREATE INDEX idx_bids_created_at ON bids (created_at DESC);
CREATE INDEX idx_bids_country_id ON bids (country_id);
CREATE INDEX idx_bids_categories ON bids USING GIN (categories);
CREATE INDEX idx_bids_search ON bids USING GIN (to_tsvector('russian', title_uk || ' ' || description_uk));

-- –î–ª—è –∫–æ–º–ø–∞–Ω–∏–π
CREATE INDEX idx_companies_name ON companies (name);
CREATE INDEX idx_companies_country ON companies (country);
CREATE INDEX idx_companies_city ON companies (city);

-- –î–ª—è –±–ª–æ–≥ —Å—Ç–∞—Ç–µ–π
CREATE INDEX idx_blog_published_created ON blog_articles (is_published, created_at DESC);
CREATE INDEX idx_blog_slug_uk ON blog_articles (slug_uk);
```

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤:

```python
# –ò—Å–ø–æ–ª—å–∑—É–µ–º select_related –¥–ª—è ForeignKey
Bid.all().select_related('country', 'author')

# –ò—Å–ø–æ–ª—å–∑—É–µ–º prefetch_related –¥–ª—è ManyToMany
Company.all().prefetch_related('categories', 'subcategories')

# –î–æ–±–∞–≤–ª—è–µ–º –ª–∏–º–∏—Ç—ã –≤–µ–∑–¥–µ
query.limit(100)  # –ó–∞—â–∏—Ç–∞ –æ—Ç –±–æ–ª—å—à–∏—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
```

---

## ‚öôÔ∏è **Middleware –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏**

### 1. **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ middleware**

```python
class CacheMiddleware:
    def __init__(self, app):
        self.app = app
        self.redis = redis.Redis()

    async def __call__(self, scope, receive, send):
        if scope["type"] == "http" and scope["method"] == "GET":
            cache_key = f"response:{scope['path']}:{scope['query_string']}"
            cached = await self.redis.get(cache_key)
            if cached:
                # –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç
                pass

        # –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –æ–±—ã—á–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
        await self.app(scope, receive, send)
```

### 2. **–ö–æ–º–ø—Ä–µ—Å—Å–∏—è —Å—Ç–∞—Ç–∏–∫–∏**

```python
# –í app.py
from fastapi.middleware.gzip import GZipMiddleware
app.add_middleware(GZipMiddleware, minimum_size=1000)
```

### 3. **CORS –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è**

```python
# –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π CORS
app.add_middleware(
    CORSMiddleware,
    allow_origins=["https://yourdomain.com"],  # –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –¥–æ–º–µ–Ω—ã
    allow_credentials=True,
    allow_methods=["GET", "POST", "PUT", "DELETE"],
    allow_headers=["*"],
    max_age=86400,  # –ö—ç—à–∏—Ä—É–µ–º preflight –∑–∞–ø—Ä–æ—Å—ã
)
```

---

## üìà **–ü–ª–∞–Ω –≤–Ω–µ–¥—Ä–µ–Ω–∏—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π**

### **–§–∞–∑–∞ 1: –ö—Ä–∏—Ç–∏—á–Ω—ã–µ (1-2 –¥–Ω—è)**

1. ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞—è–≤–æ–∫ - –ì–û–¢–û–í–û
2. ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–π - –ì–û–¢–û–í–û
3. üîÑ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –±–ª–æ–≥ —Å—Ç–∞—Ç–µ–π
4. üîÑ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –±–∞–∑–æ–≤—ã—Ö –∏–Ω–¥–µ–∫—Å–æ–≤

### **–§–∞–∑–∞ 2: –°—Ä–µ–¥–Ω–∏–µ (3-5 –¥–Ω–µ–π)**

1. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Å–ø–∏—Å–∫–æ–≤ (–∑–∞—è–≤–∫–∏/–∫–æ–º–ø–∞–Ω–∏–∏)
2. –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
3. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª–∏

### **–§–∞–∑–∞ 3: –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–µ (1 –Ω–µ–¥–µ–ª—è)**

1. Redis –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ
2. CDN –¥–ª—è —Å—Ç–∞—Ç–∏–∫–∏
3. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
4. –ü–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫

---

## üéØ **–û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã**

| –≠–Ω–¥–ø–æ–∏–Ω—Ç             | –î–æ        | –ü–æ—Å–ª–µ       | –£–ª—É—á—à–µ–Ω–∏–µ |
| -------------------- | --------- | ----------- | --------- |
| –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞—è–≤–∫–∏      | 6-11 —Å–µ–∫  | 1.8-3.5 —Å–µ–∫ | 70-80% ‚úÖ |
| –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏    | 3-5 —Å–µ–∫   | 1-2 —Å–µ–∫     | 60-70% ‚úÖ |
| –°–æ–∑–¥–∞–Ω–∏–µ –±–ª–æ–≥ —Å—Ç–∞—Ç—å–∏ | 10-15 —Å–µ–∫ | 2-3 —Å–µ–∫     | 80-90% üîÑ |
| –°–ø–∏—Å–æ–∫ –∑–∞—è–≤–æ–∫        | 2-5 —Å–µ–∫   | 0.5-1 —Å–µ–∫   | 75-80% üîÑ |
| –°–ø–∏—Å–æ–∫ –∫–æ–º–ø–∞–Ω–∏–π      | 1-3 —Å–µ–∫   | 0.3-0.8 —Å–µ–∫ | 70-75% üîÑ |

---

## üöÄ **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è**

### **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏**:

- **Redis**: –¥–ª—è —á–∞—Å—Ç—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ (—Å–ø–∏—Å–∫–∏, —Ñ–∏–ª—å—Ç—Ä—ã)
- **HTTP –∫—ç—à**: –¥–ª—è —Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
- **Application –∫—ç—à**: –¥–ª—è –ø–µ—Ä–µ–≤–æ–¥–æ–≤ –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π

### **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**:

- –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –ë–î
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏
- –ß–∞—Å—Ç–æ—Ç–∞ –æ–±—Ä–∞—â–µ–Ω–∏–π –∫ –ø–µ—Ä–µ–≤–æ–¥—á–∏–∫—É

### **–ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ**:

- –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ FastAPI
- –†–µ–ø–ª–∏–∫–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —á—Ç–µ–Ω–∏—è
- CDN –¥–ª—è —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ñ–∞–π–ª–æ–≤
- Load Balancer –¥–ª—è –≤—ã—Å–æ–∫–∏—Ö –Ω–∞–≥—Ä—É–∑–æ–∫

**–û–±—â–µ–µ —É—Å–∫–æ—Ä–µ–Ω–∏–µ —Å–∞–π—Ç–∞: 70-85%** üéâ
